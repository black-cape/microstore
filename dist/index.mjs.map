{"version":3,"sources":["../src/interpreter.ts","../src/transforms.ts","../src/microstore.ts","../src/provider.tsx","../src/reactive.ts"],"names":["RESTInterpreter","data","_options","typedPayload","meta","k","content","typedData","typeName","camelCase","singularize","isArray","item","json","microStoreReservedKeys","defaultFieldTransforms","MicroStore","options","__publicField","createStore","createQueries","transformedSchemas","k2","omit","type","possiblePK","row","schema","serializedRow","field","transform","deserializedRow","method","typeKey","pluralize","rawData","batchedPayload","payload","pk","e","id","transformer","effectiveTransformer","x","table","_","record","schemaName","StoreContext","createContext","useMicroStore","useContext","MicroStoreProvider","props","store","useMemo","jsx","TinyBaseProvider","directIds","generateFilter","obj","resetQueryDefinition","queryName","queries","filter","select","where","getCell","useReactive","uniqueHookID","useState","useQueries","rows","useResultTable","lastFilter","setLastFilter","airBrake","useRef","useEffect","stringifiedFilter","returnData","identifier","possibleRow","thing"],"mappings":"0UACA,IAAA,CAAA,CAAA,MAAA,CAAA,cAAA,CAAA,IAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,GAAA,CAAA,IAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,UAAA,CAAA,IAAA,CAAA,YAAA,CAAA,IAAA,CAAA,QAAA,CAAA,IAAA,CAAA,KAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,IAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,GAAA,CAAA,CAAA,CAAA,CAAA,OAAA,CAAA,EAAA,QAAA,CAAA,CAAA,CAAA,EAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAIO,SAASA,CAAAA,CAAgBC,CAAAA,CAA2BC,CAAAA,CAA+B,CACxF,IAAMC,CAAAA,CAAuC,CAC3C,IAAA,CAAM,EAAC,CACP,IAAA,CAAM,MACR,CAAA,CACIC,EAEJ,OAAIH,CAAAA,GAAS,MAAA,EACX,MAAA,CAAO,KAAKA,CAAI,CAAA,CAAE,OAAA,CAASI,CAAAA,EAAM,CAC/B,IAAMC,CAAAA,CAAUL,CAAAA,CAAKI,CAAC,CAAA,CACtB,GAAIA,CAAAA,GAAM,MAAA,CAAQ,CAChB,IAAME,CAAAA,CAAmC,EAAC,CACpCC,EAAWC,SAAAA,CAAUC,WAAAA,CAAYL,CAAC,CAAC,EACrCM,OAAAA,CAAQL,CAAO,CAAA,CACjBA,CAAAA,CAAQ,QAASM,CAAAA,EAAc,CAC7BL,CAAAA,CAAU,IAAA,CAAKK,CAAI,EACrB,CAAC,CAAA,CAEDL,CAAAA,CAAU,KAAKD,CAAO,CAAA,CAExBH,CAAAA,CAAa,IAAA,CAAK,KAAK,CACrB,IAAA,CAAMI,CAAAA,CACN,IAAA,CAAMC,CACR,CAAC,EACH,CAAA,KACEJ,EAAOH,CAAAA,CAAKI,CAAC,EAEjB,CAAC,EAEHF,CAAAA,CAAa,IAAA,CAAOC,CAAAA,CACbD,CACT,CCjCO,IAAMU,CAAAA,CAAuB,CAClC,SAAA,CAAUZ,CAAAA,CAAM,CACd,OAAOA,CAAAA,CAAO,IAAA,CAAK,SAAA,CAAUA,CAAI,EAAI,IACvC,CAAA,CACA,WAAA,CAAYA,CAAAA,CAAM,CAChB,OAAOA,CAAAA,CAAO,IAAA,CAAK,KAAA,CAAMA,CAAI,CAAA,CAAI,IACnC,CACF,MCUMa,CAAAA,CAAyB,CAAC,WAAA,CAAa,YAAY,EACnDC,CAAAA,CAAyB,CAC7B,IAAA,CAAAF,CACF,EAEaG,CAAAA,CAAN,KAAiB,CAStB,WAAA,CAAYC,EAA4B,CARxCC,CAAAA,CAAA,IAAA,CAAA,SAAA,CAAA,CACAA,CAAAA,CAAA,IAAA,CAAA,iBAAA,CAAA,CACAA,CAAAA,CAAA,IAAA,CAAA,kBAAA,CAAA,CACAA,CAAAA,CAAA,cACAA,CAAAA,CAAA,IAAA,CAAA,SAAA,CAAA,CACAA,CAAAA,CAAA,IAAA,CAAA,aAAA,CAAA,CACAA,EAAA,IAAA,CAAQ,aAAA,CAAA,CAGN,IAAA,CAAK,WAAA,CAAc,EAAC,CACpB,IAAA,CAAK,OAAA,CAAUD,CAAAA,CAAQ,OAAA,CAAUA,CAAAA,CAAQ,OAAA,CAAU,GAEnD,IAAA,CAAK,eAAA,CAAkB,CAAE,GAAIA,EAAQ,eAAA,CAAkBA,CAAAA,CAAQ,eAAA,CAAkB,GAAK,GAAGF,CAAuB,CAAA,CAChH,IAAA,CAAK,gBAAA,CAAmBE,CAAAA,CAAQ,gBAAA,CAAmBA,CAAAA,CAAQ,iBAAmB,EAAC,CAC/E,IAAA,CAAK,WAAA,CAAcA,EAAQ,WAAA,CAAcA,CAAAA,CAAQ,WAAA,CAAcjB,CAAAA,CAC/D,KAAK,KAAA,CAAQmB,WAAAA,EAAY,CACzB,IAAA,CAAK,MAAM,eAAA,CAAgB,IAAA,CAAK,gBAAA,EAAkB,EAClD,IAAA,CAAK,OAAA,CAAUC,aAAAA,CAAc,IAAA,CAAK,KAAK,EACzC,CAEQ,gBAAA,EAAmB,CAGzB,IAAMC,CAAAA,CAA0C,EAAC,CACjD,OAAA,MAAA,CAAO,IAAA,CAAK,IAAA,CAAK,OAAO,CAAA,CAAE,QAAShB,CAAAA,EAAM,CAgBvC,GAfAgB,CAAAA,CAAmBhB,CAAC,CAAA,CAAwB,EAAC,CAC7C,MAAA,CAAO,KAAK,IAAA,CAAK,OAAA,CAAQA,CAAC,CAAC,EAAE,OAAA,CAASiB,CAAAA,EAAO,CAG3C,GAFAD,EAAmBhB,CAAC,CAAA,CAAEiB,CAAE,CAAA,CAAIC,KAAK,IAAA,CAAK,OAAA,CAAQlB,CAAC,CAAA,CAAEiB,CAAE,CAAA,CAAGR,CAAsB,CAAA,CACpC,IAAA,CAAK,OAAA,CAAQT,CAAC,CAAA,CAAEiB,CAAE,EAAE,UAAA,EAC1C,IAAA,CAAK,OAAA,CAAQjB,CAAC,EAAEiB,CAAE,CAAA,CAAE,IAAA,GAAY,QAAA,CAAU,CAC1D,GAAI,IAAA,CAAK,WAAA,CAAYjB,CAAC,EACpB,MAAM,KAAA,CAAM,CAAA,6CAAA,EAAgDA,CAAC,EAAE,CAAA,CAEjE,IAAA,CAAK,WAAA,CAAYA,CAAC,EAAIiB,EACxB,CACF,CAAC,CAAA,CAEG,CAAC,IAAA,CAAK,aAAA,CAAcjB,CAAC,CAAA,EAAK,IAAA,CAAK,OAAA,CAAQA,CAAC,CAAA,CAAE,IAAS,IAAA,CAAK,OAAA,CAAQA,CAAC,CAAA,CAAE,GAAM,IAAA,GAAY,QAAA,GACvF,IAAA,CAAK,WAAA,CAAYA,CAAC,CAAA,CAAI,IAAA,CAAA,CAEpB,CAAC,IAAA,CAAK,aAAA,CAAcA,CAAC,CAAA,CACvB,MAAM,MACJ,CAAA,kCAAA,EAAqCA,CAAC,CAAA,wHAAA,CACxC,CAEJ,CAAC,CAAA,CACMgB,CACT,CAEA,aAAA,CAAcG,EAAc,CAC1B,IAAMC,CAAAA,CAAa,IAAA,CAAK,WAAA,CAAYD,CAAI,CAAA,CACxC,OAAOC,GAA0B,MACnC,CAEA,SAAA,CAAUD,CAAAA,CAAc,CACtB,OAAIA,CAAAA,EACE,MAAA,CAAO,MAAA,CAAO,KAAK,OAAA,CAASA,CAAI,CAAA,CAC3B,IAAA,CAAK,QAAQA,CAAI,CAAA,CAGrB,IACT,CAEA,mBAAmBA,CAAAA,CAA0B,CAC3C,GAAIA,CAAAA,CACF,OAAO,IAAA,CAAK,gBAAA,CAAiBA,CAAI,CAAA,CAAI,KAAK,gBAAA,CAAiBA,CAAI,CAAA,CAAI,MAGvE,CAEA,iBAAA,CAAkBA,CAAAA,CAA0B,CAC1C,GAAIA,CAAAA,CACF,OAAO,IAAA,CAAK,eAAA,CAAgBA,CAAI,CAAA,CAAI,IAAA,CAAK,eAAA,CAAgBA,CAAI,EAAI,MAGrE,CAEA,SAAA,CAAUE,CAAAA,CAAaC,EAA0B,CAC/C,IAAMC,CAAAA,CAAwB,GAC9B,OAAA,MAAA,CAAO,IAAA,CAAKF,CAAG,CAAA,CAAE,QAASrB,CAAAA,EAAM,CAC9B,IAAMwB,CAAAA,CAAQF,EAAOtB,CAAC,CAAA,CACtB,GAAIwB,CAAAA,CAAO,CACT,IAAMC,CAAAA,CAAY,IAAA,CAAK,kBAAkBD,CAAAA,CAAM,SAAS,CAAA,CACxDD,CAAAA,CAAcvB,CAAC,CAAA,CAAIyB,CAAAA,CAAYA,CAAAA,CAAU,SAAA,CAAUJ,EAAIrB,CAAC,CAAC,CAAA,CAAIqB,CAAAA,CAAIrB,CAAC,EACpE,CACF,CAAC,CAAA,CACMuB,CACT,CAEA,WAAA,CAAYF,CAAAA,CAAUC,CAAAA,CAA0B,CAC9C,IAAMI,CAAAA,CAA0B,EAAC,CACjC,cAAO,IAAA,CAAKL,CAAG,CAAA,CAAE,OAAA,CAASrB,CAAAA,EAAM,CAC9B,IAAMwB,CAAAA,CAAQF,EAAOtB,CAAC,CAAA,CACtB,GAAIwB,CAAAA,CAAO,CACT,IAAMC,CAAAA,CACJD,CAAAA,CAAM,SAAA,EAAa,KAAK,eAAA,CAAgBA,CAAAA,CAAM,SAAS,CAAA,CAAI,IAAA,CAAK,eAAA,CAAgBA,CAAAA,CAAM,SAAS,EAAI,MAAA,CACrGE,CAAAA,CAAgB1B,CAAC,CAAA,CAAIyB,EAAYA,CAAAA,CAAU,WAAA,CAAYJ,CAAAA,CAAIrB,CAAC,CAAC,CAAA,CAAIqB,CAAAA,CAAIrB,CAAC,EACxE,CACF,CAAC,CAAA,CACM0B,CACT,CAGA,UAAA,CAAWP,CAAAA,CAAcvB,CAAAA,CAAiB+B,CAAAA,CAAoBf,EAA+B,EAAC,CAAG,CAC/F,OAAO,KAAK,WAAA,CAAYO,CAAAA,CAAM,CAACvB,CAAI,EAAG+B,CAAAA,CAAQf,CAAO,CACvD,CAGA,YAAYO,CAAAA,CAAcvB,CAAAA,CAAmB+B,CAAAA,CAAoBf,CAAAA,CAA+B,EAAC,CAAG,CAClG,IAAMa,CAAAA,CAAY,KAAK,kBAAA,CAAmBN,CAAI,CAAA,CACxCS,CAAAA,CAAUxB,SAAAA,CAAUyB,SAAAA,CAAUV,CAAI,CAAC,EACzC,GAAI,CAACM,CAAAA,CACH,OAAO,KAAK,WAAA,CAAYE,CAAAA,CAAQ,CAAE,CAACC,CAAO,EAAGhC,CAAK,CAAA,CAAGgB,CAAO,EAE9D,IAAMkB,CAAAA,CAAUlC,CAAAA,CAAK,GAAA,CAAKW,GACjBkB,CAAAA,CAAU,SAAA,CAAUlB,CAAI,CAChC,EACD,OAAO,IAAA,CAAK,WAAA,CAAYoB,CAAAA,CAAQ,CAAE,CAACC,CAAO,EAAGE,CAAQ,CAAA,CAAGlB,CAAO,CACjE,CAGA,YAAYe,CAAAA,CAAoB/B,CAAAA,CAAWgB,CAAAA,CAA+B,GAAI,CAC5E,GAAI,CACF,IAAMmB,EAAiB,IAAA,CAAK,WAAA,CAAYnC,CAAAA,CAAMgB,CAAO,EACrD,OAAAmB,CAAAA,CAAe,IAAA,CAAK,OAAA,CAASC,GAAY,CACvC,IAAMV,CAAAA,CAAS,IAAA,CAAK,UAAUU,CAAAA,CAAQ,IAAI,CAAA,CAE1C,GAAIV,EAAQ,CACV,IAAMW,CAAAA,CAAK,IAAA,CAAK,aAAA,CAAcD,CAAAA,CAAQ,IAAI,CAAA,EAAK,KAC3CL,CAAAA,GAAW,QAAA,CACbK,CAAAA,CAAQ,IAAA,CAAK,QAASX,CAAAA,EAAQ,CAC5B,IAAA,CAAK,KAAA,CAAM,OAAOW,CAAAA,CAAQ,IAAA,CAAMX,CAAAA,CAAIY,CAAE,CAAC,EACzC,CAAC,CAAA,CACQN,IAAW,OAAA,CACpBK,CAAAA,CAAQ,IAAA,CAAK,OAAA,CAASX,GAAQ,CAExB,IAAA,CAAK,KAAA,CAAM,MAAA,CAAOW,EAAQ,IAAA,CAAMX,CAAAA,CAAIY,CAAE,CAAC,CAAA,CACzC,IAAA,CAAK,KAAA,CAAM,aAAA,CAAcD,EAAQ,IAAA,CAAMX,CAAAA,CAAIY,CAAE,CAAA,CAAG,KAAK,SAAA,CAAUZ,CAAAA,CAAKC,CAAM,CAAC,EAE3E,IAAA,CAAK,KAAA,CAAM,MAAA,CAAOU,CAAAA,CAAQ,KAAMX,CAAAA,CAAIY,CAAE,CAAA,CAAG,IAAA,CAAK,UAAUZ,CAAAA,CAAKC,CAAM,CAAC,EAExE,CAAC,CAAA,CAEDU,CAAAA,CAAQ,IAAA,CAAK,OAAA,CAASX,GAAQ,CAC5B,IAAA,CAAK,KAAA,CAAM,MAAA,CAAOW,CAAAA,CAAQ,IAAA,CAAMX,CAAAA,CAAIY,CAAE,EAAG,IAAA,CAAK,SAAA,CAAUZ,CAAAA,CAAKC,CAAM,CAAC,EACtE,CAAC,EAEL,CACF,CAAC,CAAA,CACMS,CACT,CAAA,MAASG,CAAAA,CAAG,CACV,OAAA,CAAQ,IAAA,CAAKA,CAAC,EAChB,CACF,CAEA,UAAA,CAAcf,CAAAA,CAAcgB,CAAAA,CAA2B,CACrD,IAAMb,CAAAA,CAAS,IAAA,CAAK,SAAA,CAAUH,CAAI,CAAA,CAC5Bc,CAAAA,CAAK,IAAA,CAAK,aAAA,CAAcd,CAAI,CAAA,CAC5BiB,CAAAA,CAAc,IAAA,CAAK,mBAAmBjB,CAAI,CAAA,CAC1CkB,CAAAA,CAAuBD,CAAAA,CAAcA,EAAY,WAAA,CAAeE,CAAAA,EAAWA,CAAAA,CACjF,GAAIhB,GAAUW,CAAAA,CAAI,CAChB,IAAMZ,CAAAA,CAAM,KAAK,QAAA,EAAS,CAAE,MAAA,CAAOF,CAAAA,CAAMgB,CAAE,CAAA,CAC3C,GAAId,CAAAA,CACF,OAAOgB,EAAqB,IAAA,CAAK,WAAA,CAAYhB,CAAAA,CAAKC,CAAM,CAAC,CAE7D,CAEF,CAEA,OAAA,CAAWH,CAAAA,CAAmB,CAC5B,IAAMG,CAAAA,CAAS,KAAK,SAAA,CAAUH,CAAI,CAAA,CAC5Bc,CAAAA,CAAK,KAAK,aAAA,CAAcd,CAAI,CAAA,CAC5BiB,CAAAA,CAAc,KAAK,kBAAA,CAAmBjB,CAAI,CAAA,CAC1CkB,CAAAA,CAAuBD,CAAAA,CAAcA,CAAAA,CAAY,WAAA,CAAeE,CAAAA,EAAWA,EACjF,GAAIhB,CAAAA,EAAUW,CAAAA,CAAI,CAChB,IAAMM,CAAAA,CAAQ,IAAA,CAAK,QAAA,EAAS,CAAE,SAASpB,CAAI,CAAA,CAC3C,OAAO,MAAA,CAAO,OAAA,CAAQoB,CAAK,CAAA,CAAE,GAAA,CAAI,CAAC,CAACC,CAAAA,CAAGnB,CAAG,CAAA,GACzBgB,EAAqB,IAAA,CAAK,WAAA,CAAYhB,CAAAA,CAAKC,CAAM,CAAC,CAEjE,CACH,CACA,OAAO,EACT,CAEA,YAAA,CAAgBH,CAAAA,CAAcgB,EAA2B,CACvD,IAAMM,CAAAA,CAAS,IAAA,CAAK,WAActB,CAAAA,CAAMgB,CAAE,CAAA,CAC1C,OAAIM,GACF,IAAA,CAAK,QAAA,EAAS,CAAE,MAAA,CAAOtB,CAAAA,CAAMgB,CAAE,CAAA,CAE1BM,CACT,CAEA,SAAA,CAAUtB,CAAAA,CAAc,CAClB,IAAA,CAAK,UAAUA,CAAI,CAAA,EACrB,IAAA,CAAK,QAAA,GAAW,QAAA,CAASA,CAAI,EAEjC,CAEA,OAAQ,CACN,MAAA,CAAO,OAAA,CAAQ,IAAA,CAAK,OAAO,CAAA,CAAE,OAAA,CAAQ,CAAC,CAACuB,EAAYF,CAAC,CAAA,GAAM,CACxD,IAAA,CAAK,UAAUE,CAAU,EAC3B,CAAC,EACH,CAGA,QAAA,EAAW,CACT,OAAO,KAAK,KACd,CAGA,UAAA,EAAa,CACX,OAAO,IAAA,CAAK,OACd,CACF,EC1OA,IAAMC,CAAAA,CAAeC,aAAAA,CAAiC,IAAI,CAAA,CAEnD,SAASC,CAAAA,EAAmC,CAGjD,OAFcC,UAAAA,CAAWH,CAAY,CAGvC,CAIO,SAASI,EAAmBC,CAAAA,CAA0B,CAC3D,IAAMC,CAAAA,CAAQC,QAAQ,IAAMF,CAAAA,CAAM,KAAA,CAAO,CAACA,CAAK,CAAC,CAAA,CAGhD,OACEG,GAAAA,CAACR,CAAAA,CAAa,QAAA,CAAb,CAAsB,KAAA,CAAOM,EAC5B,QAAA,CAAAE,GAAAA,CAACC,QAAAA,CAAA,CAAiB,MAAOH,CAAAA,CAAM,QAAA,EAAS,CAAG,OAAA,CAASA,EAAM,UAAA,EAAW,CAClE,QAAA,CAAAD,CAAAA,CAAM,QAAA,CACT,CAAA,CACF,CAEJ,CCfA,IAAMK,EAAY,IAAI,GAAA,CAAI,CAAC,QAAA,CAAU,QAAQ,CAAC,CAAA,CAE9C,SAASC,CAAAA,CAAe1D,EAAyBqC,CAAAA,CAAY,CAC3D,OAAO,IAAI,IACTrC,CAAAA,CACIA,CAAAA,CAAK,GAAA,CAAK2D,CAAAA,EACJF,CAAAA,CAAU,GAAA,CAAI,OAAOE,CAAG,EACnBA,CAAAA,CAEFA,CAAAA,CAAItB,CAAE,CACd,EACD,EACN,CACF,CAEA,SAASuB,CAAAA,CACPrC,CAAAA,CACAG,CAAAA,CACAW,CAAAA,CACAwB,EACAC,CAAAA,CACAC,CAAAA,CACA,CAMAD,CAAAA,CAAQ,mBAAmBD,CAAAA,CAAWtC,CAAAA,CAAM,CAAC,CAAE,OAAAyC,CAAAA,CAAQ,KAAA,CAAAC,CAAM,CAAA,GAAM,CACjE,MAAA,CAAO,IAAA,CAAKvC,CAAM,CAAA,CAAE,OAAA,CAAStB,CAAAA,EAAM,CACjC4D,CAAAA,CAAO5D,CAAC,EACV,CAAC,CAAA,CACD6D,CAAAA,CAAOC,GAAYH,CAAAA,CAAO,GAAA,CAAqBG,CAAAA,CAAQ7B,CAAE,CAAC,CAAC,EAC7D,CAAC,EACH,CAIO,SAAS8B,CAAAA,CAAe5C,CAAAA,CAAcvB,CAAAA,CAAsC,CACjF,IAAMqD,CAAAA,CAAQJ,CAAAA,EAAc,CACtBvB,EAAS2B,CAAAA,EAAO,SAAA,CAAU9B,CAAI,CAAA,CAC9Bc,EAAKgB,CAAAA,EAAO,aAAA,CAAc9B,CAAI,CAAA,CACpC,GAAI,CAACG,CAAAA,EAAU,CAACW,EACd,MAAM,IAAI,KAAA,CAAM,CAAA,sCAAA,EAAyCd,CAAI,CAAA,CAAE,CAAA,CAEjE,GAAM,CAAC6C,EAAcxB,CAAC,CAAA,CAAIyB,QAAAA,CAAS,MAAA,CAAO,UAAA,EAAY,CAAA,CAChDP,CAAAA,CAAUQ,YAAW,CACrBC,CAAAA,CAAOC,cAAAA,CAAeJ,CAAAA,CAAcN,CAAO,CAAA,CAC3C,CAACW,CAAAA,CAAYC,CAAa,EAAIL,QAAAA,CAAS,EAAE,CAAA,CAGzCM,CAAAA,CAAWC,MAAAA,CAAO,EAAE,CAAA,CAK1BC,SAAAA,CAAU,IAAM,CACd,GAAIf,CAAAA,CAAS,CACX,IAAMC,CAAAA,CAASL,CAAAA,CAAe1D,CAAAA,CAAMqC,CAAE,EAChCyC,CAAAA,CAAoB,IAAA,CAAK,SAAA,CAAUf,CAAM,EAC3CU,CAAAA,GAAeK,CAAAA,EAAqBH,CAAAA,CAAS,OAAA,GAAYG,IACvD,MAAA,CAAO,OAAA,CAAQP,CAAI,CAAA,CAAE,OAAS,CAAA,GAChCI,CAAAA,CAAS,OAAA,CAAUG,CAAAA,CAAAA,CAErBJ,EAAcI,CAAiB,CAAA,CAC/BlB,CAAAA,CAAqBrC,CAAAA,CAAMG,CAAAA,CAAQW,CAAAA,CAAI+B,CAAAA,CAAcN,CAAAA,CAASC,CAAM,CAAA,EAExE,CACF,CAAA,CAAG,CAAC/D,EAAMqC,CAAAA,CAAIX,CAAAA,CAAQH,CAAAA,CAAMuC,CAAAA,CAASM,EAAcK,CAAAA,CAAYF,CAAAA,CAAMI,CAAQ,CAAC,EAE9E,IAAMnC,CAAAA,CAAca,CAAAA,EAAO,kBAAA,CAAmB9B,CAAI,CAAA,CAC5CkB,CAAAA,CAAuBD,CAAAA,CAAcA,CAAAA,CAAY,YAAeE,CAAAA,EAAWA,CAAAA,CAC3EqC,CAAAA,CAAkB,GACxB,OAAA/E,CAAAA,CAAK,OAAA,CAASW,CAAAA,EAAc,CAC1B,IAAMqE,CAAAA,CAAavB,CAAAA,CAAU,IAAI,OAAO9C,CAAI,CAAA,CAAIA,CAAAA,CAAOA,EAAK0B,CAAE,CAAA,CACxD4C,CAAAA,CAAcV,CAAAA,CAAKS,CAAU,CAAA,CACnC,GAAIC,CAAAA,CAAa,CACf,IAAMC,CAAAA,CAAa7B,CAAAA,EAAO,WAAA,CAAY4B,CAAAA,CAAavD,CAAM,CAAA,CACzDqD,CAAAA,CAAW,IAAA,CAAKtC,CAAAA,CAAqByC,CAAK,CAAM,EAClD,CACF,CAAC,EACMH,CACT","file":"index.mjs","sourcesContent":["// This software is provided to the United States Government (USG) with SBIR Data Rights as defined at Federal Acquisition Regulation 52.227-14, \"Rights in Data-SBIR Program\" (May 2014) SBIR Rights Notice (Dec 2026) These SBIR data are furnished with SBIR rights under Contract No. H9241522D0001. For a period of 19 years, unless extended in accordance with FAR 27.409(h), after acceptance of all items to be delivered under this contract, the Government will use these data for Government purposes only, and they shall not be disclosed outside the Government (including disclosure for procurement purposes) during such period without permission of the Contractor, except that, subject to the foregoing use and disclosure prohibitions, these data may be disclosed for use by support Contractors. After the protection period, the Government has a paid-up license to use, and to authorize others to use on its behalf, these data for Government purposes, but is relieved of all disclosure prohibitions and assumes no liability for unauthorized use of these data by third parties. This notice shall be affixed to any reproductions of these data, in whole or in part.\nimport { singularize } from 'ember-inflector';\nimport { camelCase, isArray } from 'lodash-es';\nimport type { InterpreterReturnValue } from './types';\n\nexport function RESTInterpreter(data: Record<string, any>, _options: Record<string, any>) {\n  const typedPayload: InterpreterReturnValue = {\n    data: [],\n    meta: undefined\n  };\n  let meta: Record<string, any> | undefined = undefined;\n\n  if (data !== undefined) {\n    Object.keys(data).forEach((k) => {\n      const content = data[k];\n      if (k !== 'meta') {\n        const typedData: Record<string, any>[] = [];\n        const typeName = camelCase(singularize(k));\n        if (isArray(content)) {\n          content.forEach((item: any) => {\n            typedData.push(item);\n          });\n        } else {\n          typedData.push(content);\n        }\n        typedPayload.data.push({\n          data: typedData,\n          type: typeName\n        });\n      } else {\n        meta = data[k];\n      }\n    });\n  }\n  typedPayload.meta = meta;\n  return typedPayload;\n}\n","// This software is provided to the United States Government (USG) with SBIR Data Rights as defined at Federal Acquisition Regulation 52.227-14, \"Rights in Data-SBIR Program\" (May 2014) SBIR Rights Notice (Dec 2026) These SBIR data are furnished with SBIR rights under Contract No. H9241522D0001. For a period of 19 years, unless extended in accordance with FAR 27.409(h), after acceptance of all items to be delivered under this contract, the Government will use these data for Government purposes only, and they shall not be disclosed outside the Government (including disclosure for procurement purposes) during such period without permission of the Contractor, except that, subject to the foregoing use and disclosure prohibitions, these data may be disclosed for use by support Contractors. After the protection period, the Government has a paid-up license to use, and to authorize others to use on its behalf, these data for Government purposes, but is relieved of all disclosure prohibitions and assumes no liability for unauthorized use of these data by third parties. This notice shall be affixed to any reproductions of these data, in whole or in part.\nimport type { FieldTransform } from './types';\n\nexport const json: FieldTransform = {\n  serialize(data) {\n    return data ? JSON.stringify(data) : null;\n  },\n  deserialize(data) {\n    return data ? JSON.parse(data) : null;\n  }\n};\n","// This software is provided to the United States Government (USG) with SBIR Data Rights as defined at Federal Acquisition Regulation 52.227-14, \"Rights in Data-SBIR Program\" (May 2014) SBIR Rights Notice (Dec 2026) These SBIR data are furnished with SBIR rights under Contract No. H9241522D0001. For a period of 19 years, unless extended in accordance with FAR 27.409(h), after acceptance of all items to be delivered under this contract, the Government will use these data for Government purposes only, and they shall not be disclosed outside the Government (including disclosure for procurement purposes) during such period without permission of the Contractor, except that, subject to the foregoing use and disclosure prohibitions, these data may be disclosed for use by support Contractors. After the protection period, the Government has a paid-up license to use, and to authorize others to use on its behalf, these data for Government purposes, but is relieved of all disclosure prohibitions and assumes no liability for unauthorized use of these data by third parties. This notice shall be affixed to any reproductions of these data, in whole or in part.\nimport { pluralize } from 'ember-inflector';\nimport { camelCase, omit } from 'lodash-es';\nimport { createQueries, createStore, type CellSchema, type Queries, type Row, type Store } from 'tinybase';\nimport { RESTInterpreter } from './interpreter';\nimport { json } from './transforms';\nimport type {\n  ConventionalSchema,\n  ConventionalSchemas,\n  FieldTransforms,\n  MethodType,\n  MicrostoreInterpreter,\n  MicroStoreOptions,\n  MicroStoreSchema,\n  MicroStoreSchemas,\n  RawRecord,\n  RawRow,\n  RecordTransforms\n} from './types';\n\nconst microStoreReservedKeys = ['transform', 'primaryKey'];\nconst defaultFieldTransforms = {\n  json\n};\n\nexport class MicroStore {\n  schemas: MicroStoreSchemas;\n  fieldTransforms: FieldTransforms;\n  recordTransforms: RecordTransforms;\n  store: Store;\n  queries: Queries;\n  interpreter: MicrostoreInterpreter;\n  private primaryKeys: Record<string, string>;\n\n  constructor(options: MicroStoreOptions) {\n    this.primaryKeys = {};\n    this.schemas = options.schemas ? options.schemas : {};\n    // Thats right, we even support our own field and record level transforms!\n    this.fieldTransforms = { ...(options.fieldTransforms ? options.fieldTransforms : {}), ...defaultFieldTransforms };\n    this.recordTransforms = options.recordTransforms ? options.recordTransforms : {};\n    this.interpreter = options.interpreter ? options.interpreter : RESTInterpreter;\n    this.store = createStore();\n    this.store.setTablesSchema(this.transformSchemas());\n    this.queries = createQueries(this.store);\n  }\n\n  private transformSchemas() {\n    // we have to remove custom properties or tinybase\n    // will ignore our fields.\n    const transformedSchemas: ConventionalSchemas = {};\n    Object.keys(this.schemas).forEach((k) => {\n      transformedSchemas[k] = <ConventionalSchema>{};\n      Object.keys(this.schemas[k]).forEach((k2) => {\n        transformedSchemas[k][k2] = omit(this.schemas[k][k2], microStoreReservedKeys) as CellSchema;\n        const possiblePK: boolean | undefined = this.schemas[k][k2]['primaryKey'];\n        if (possiblePK && this.schemas[k][k2]['type'] === 'string') {\n          if (this.primaryKeys[k]) {\n            throw Error(`More than one primary key defined for schema ${k}`);\n          }\n          this.primaryKeys[k] = k2;\n        }\n      });\n      // Default PK to id\n      if (!this.getPrimaryKey(k) && this.schemas[k]['id'] && this.schemas[k]['id']['type'] === 'string') {\n        this.primaryKeys[k] = 'id';\n      }\n      if (!this.getPrimaryKey(k)) {\n        throw Error(\n          `No primary key defined for schema ${k}. This schema must have an 'id' field of \"type\": \"string\", or another field of \"type\": \"string\" with \"primaryKey\": true.`\n        );\n      }\n    });\n    return transformedSchemas;\n  }\n\n  getPrimaryKey(type: string) {\n    const possiblePK = this.primaryKeys[type];\n    return possiblePK ? possiblePK : undefined;\n  }\n\n  getSchema(type: string) {\n    if (type) {\n      if (Object.hasOwn(this.schemas, type)) {\n        return this.schemas[type];\n      }\n    }\n    return null;\n  }\n\n  getRecordTransform(type: string | undefined) {\n    if (type) {\n      return this.recordTransforms[type] ? this.recordTransforms[type] : undefined;\n    }\n    return undefined;\n  }\n\n  getFieldTransform(type: string | undefined) {\n    if (type) {\n      return this.fieldTransforms[type] ? this.fieldTransforms[type] : undefined;\n    }\n    return undefined;\n  }\n\n  serialize(row: RawRow, schema: MicroStoreSchema) {\n    const serializedRow: RawRow = {};\n    Object.keys(row).forEach((k) => {\n      const field = schema[k];\n      if (field) {\n        const transform = this.getFieldTransform(field.transform);\n        serializedRow[k] = transform ? transform.serialize(row[k]) : row[k];\n      }\n    });\n    return serializedRow;\n  }\n\n  deserialize(row: Row, schema: MicroStoreSchema) {\n    const deserializedRow: RawRow = {};\n    Object.keys(row).forEach((k) => {\n      const field = schema[k];\n      if (field) {\n        const transform =\n          field.transform && this.fieldTransforms[field.transform] ? this.fieldTransforms[field.transform] : undefined;\n        deserializedRow[k] = transform ? transform.deserialize(row[k]) : row[k];\n      }\n    });\n    return deserializedRow;\n  }\n\n  // pushRecord is a sugar method to take a single record and push it into the store using whatever verb was used\n  pushRecord(type: string, data: RawRecord, method: MethodType, options: Record<string, any> = {}) {\n    return this.pushRecords(type, [data], method, options);\n  }\n\n  // pushRecords handles an incoming data (\"row\"s) that are in application level format (with dates, blobs, or other complex types that can't be POJO'd)\n  pushRecords(type: string, data: RawRecord[], method: MethodType, options: Record<string, any> = {}) {\n    const transform = this.getRecordTransform(type);\n    const typeKey = camelCase(pluralize(type));\n    if (!transform) {\n      return this.pushPayload(method, { [typeKey]: data }, options);\n    }\n    const rawData = data.map((item) => {\n      return transform.serialize(item);\n    });\n    return this.pushPayload(method, { [typeKey]: rawData }, options);\n  }\n\n  // pushPayload handles incoming data (many \"row\"s) that are in POJO format\n  pushPayload(method: MethodType, data: any, options: Record<string, any> = {}) {\n    try {\n      const batchedPayload = this.interpreter(data, options);\n      batchedPayload.data.forEach((payload) => {\n        const schema = this.getSchema(payload.type);\n        // Only process typed batches that match a defined data schema\n        if (schema) {\n          const pk = this.getPrimaryKey(payload.type) || 'id';\n          if (method === 'DELETE') {\n            payload.data.forEach((row) => {\n              this.store.delRow(payload.type, row[pk]);\n            });\n          } else if (method === 'PATCH') {\n            payload.data.forEach((row) => {\n              // Only try a partial row update if a row already exists\n              if (this.store.getRow(payload.type, row[pk])) {\n                this.store.setPartialRow(payload.type, row[pk], this.serialize(row, schema));\n              } else {\n                this.store.setRow(payload.type, row[pk], this.serialize(row, schema));\n              }\n            });\n          } else {\n            payload.data.forEach((row) => {\n              this.store.setRow(payload.type, row[pk], this.serialize(row, schema));\n            });\n          }\n        }\n      });\n      return batchedPayload;\n    } catch (e) {\n      console.warn(e);\n    }\n  }\n\n  peekRecord<T>(type: string, id: string): T | undefined {\n    const schema = this.getSchema(type);\n    const pk = this.getPrimaryKey(type);\n    const transformer = this.getRecordTransform(type);\n    const effectiveTransformer = transformer ? transformer.deserialize : (x: any) => x;\n    if (schema && pk) {\n      const row = this.getStore().getRow(type, id);\n      if (row) {\n        return effectiveTransformer(this.deserialize(row, schema));\n      }\n    }\n    return undefined;\n  }\n\n  peekAll<T>(type: string): T[] {\n    const schema = this.getSchema(type);\n    const pk = this.getPrimaryKey(type);\n    const transformer = this.getRecordTransform(type);\n    const effectiveTransformer = transformer ? transformer.deserialize : (x: any) => x;\n    if (schema && pk) {\n      const table = this.getStore().getTable(type);\n      return Object.entries(table).map(([_, row]) => {\n        const thing = effectiveTransformer(this.deserialize(row, schema));\n        return thing as T;\n      });\n    }\n    return [];\n  }\n\n  unloadRecord<T>(type: string, id: string): T | undefined {\n    const record = this.peekRecord<T>(type, id);\n    if (record) {\n      this.getStore().delRow(type, id);\n    }\n    return record;\n  }\n\n  unloadAll(type: string) {\n    if (this.getSchema(type)) {\n      this.getStore().delTable(type);\n    }\n  }\n\n  reset() {\n    Object.entries(this.schemas).forEach(([schemaName, _]) => {\n      this.unloadAll(schemaName);\n    });\n  }\n\n  // Need to get the raw tinybase store? use this method\n  getStore() {\n    return this.store;\n  }\n\n  // Need to get the raw tinybase query views? use this method\n  getQueries() {\n    return this.queries;\n  }\n}\n","// This software is provided to the United States Government (USG) with SBIR Data Rights as defined at Federal Acquisition Regulation 52.227-14, \"Rights in Data-SBIR Program\" (May 2014) SBIR Rights Notice (Dec 2026) These SBIR data are furnished with SBIR rights under Contract No. H9241522D0001. For a period of 19 years, unless extended in accordance with FAR 27.409(h), after acceptance of all items to be delivered under this contract, the Government will use these data for Government purposes only, and they shall not be disclosed outside the Government (including disclosure for procurement purposes) during such period without permission of the Contractor, except that, subject to the foregoing use and disclosure prohibitions, these data may be disclosed for use by support Contractors. After the protection period, the Government has a paid-up license to use, and to authorize others to use on its behalf, these data for Government purposes, but is relieved of all disclosure prohibitions and assumes no liability for unauthorized use of these data by third parties. This notice shall be affixed to any reproductions of these data, in whole or in part.\nimport { createContext, useContext, useMemo, type ReactNode } from 'react';\nimport { Provider as TinyBaseProvider } from 'tinybase/ui-react';\nimport type { MicroStore } from './microstore';\n\nconst StoreContext = createContext<MicroStore | null>(null);\n\nexport function useMicroStore(): MicroStore | null {\n  const store = useContext(StoreContext);\n\n  return store;\n}\n\ntype WithExistingStore = { store: MicroStore; children: ReactNode };\n\nexport function MicroStoreProvider(props: WithExistingStore) {\n  const store = useMemo(() => props.store, [props]);\n\n  // TODO: Add store.relationships, which can be passed to tinybase\n  return (\n    <StoreContext.Provider value={store}>\n      <TinyBaseProvider store={store.getStore()} queries={store.getQueries()}>\n        {props.children}\n      </TinyBaseProvider>\n    </StoreContext.Provider>\n  );\n}\n","// This software is provided to the United States Government (USG) with SBIR Data Rights as defined at Federal Acquisition Regulation 52.227-14, \"Rights in Data-SBIR Program\" (May 2014) SBIR Rights Notice (Dec 2026) These SBIR data are furnished with SBIR rights under Contract No. H9241522D0001. For a period of 19 years, unless extended in accordance with FAR 27.409(h), after acceptance of all items to be delivered under this contract, the Government will use these data for Government purposes only, and they shall not be disclosed outside the Government (including disclosure for procurement purposes) during such period without permission of the Contractor, except that, subject to the foregoing use and disclosure prohibitions, these data may be disclosed for use by support Contractors. After the protection period, the Government has a paid-up license to use, and to authorize others to use on its behalf, these data for Government purposes, but is relieved of all disclosure prohibitions and assumes no liability for unauthorized use of these data by third parties. This notice shall be affixed to any reproductions of these data, in whole or in part.\n// This whole file will get \"genericized\" so that it can wrap any useQuery that we currently use\n// Right now it is hard coded to do object stuff...\n// The same logic can be made more abstract and receive a couple more\n// arguments to then handle ANYTHING. :)\nimport { useEffect, useRef, useState } from 'react';\nimport { type Queries } from 'tinybase';\nimport { useQueries, useResultTable } from 'tinybase/ui-react';\nimport { useMicroStore } from './provider';\nimport type { MicroStoreSchema } from './types';\n\nconst directIds = new Set(['string', 'number']);\n\nfunction generateFilter(data: any[] | undefined, pk: string) {\n  return new Set(\n    data\n      ? data.map((obj) => {\n          if (directIds.has(typeof obj)) {\n            return obj;\n          }\n          return obj[pk];\n        })\n      : []\n  );\n}\n\nfunction resetQueryDefinition(\n  type: string,\n  schema: MicroStoreSchema,\n  pk: string,\n  queryName: string,\n  queries: Queries,\n  filter: Set<string | number>\n) {\n  // So what exactly does this do? It returns all the same tinybase rows that are\n  // returned by the same React query being referenced by this reactive wrapper!!\n  // That way, when the rows from useResultTable change due to some localized store\n  // update through the MicroStore engine, we see those changes reflected without\n  // additional server traffic!\n  queries.setQueryDefinition(queryName, type, ({ select, where }) => {\n    Object.keys(schema).forEach((k) => {\n      select(k);\n    });\n    where((getCell) => filter.has(<string | number>getCell(pk)));\n  });\n}\n\n// Wrap the objects in tinybase rows to make them react at a record level\n// to individual record changes\nexport function useReactive<T>(type: string, data: T[] | string[] | number[]): T[] {\n  const store = useMicroStore();\n  const schema = store?.getSchema(type);\n  const pk = store?.getPrimaryKey(type);\n  if (!schema || !pk) {\n    throw new Error(`No MicroStore schema defined for type ${type}`);\n  }\n  const [uniqueHookID, _] = useState(crypto.randomUUID());\n  const queries = useQueries();\n  const rows = useResultTable(uniqueHookID, queries);\n  const [lastFilter, setLastFilter] = useState('');\n  // Air Brake prevents render loops if a user does something very silly like chasing\n  // records in a circle\n  const airBrake = useRef('');\n\n  // Why is this effect important? Because you ONLY want to update the thing\n  // that is bubbling out new rows (the query) if the supporting REST request\n  // with its own internal IDs has changed. We\n  useEffect(() => {\n    if (queries) {\n      const filter = generateFilter(data, pk);\n      const stringifiedFilter = JSON.stringify(filter);\n      if (lastFilter !== stringifiedFilter && airBrake.current !== stringifiedFilter) {\n        if (Object.entries(rows).length > 0) {\n          airBrake.current = stringifiedFilter;\n        }\n        setLastFilter(stringifiedFilter);\n        resetQueryDefinition(type, schema, pk, uniqueHookID, queries, filter);\n      }\n    }\n  }, [data, pk, schema, type, queries, uniqueHookID, lastFilter, rows, airBrake]);\n\n  const transformer = store?.getRecordTransform(type);\n  const effectiveTransformer = transformer ? transformer.deserialize : (x: any) => x;\n  const returnData: T[] = [];\n  data.forEach((item: any) => {\n    const identifier = directIds.has(typeof item) ? item : item[pk];\n    const possibleRow = rows[identifier];\n    if (possibleRow) {\n      const thing: any = store?.deserialize(possibleRow, schema);\n      returnData.push(effectiveTransformer(thing) as T);\n    }\n  });\n  return returnData;\n}\n"]}